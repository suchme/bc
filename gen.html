<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache" />
<title>datagen</title>
</head>

<body>
<div>ちょっとまって</div>
</body>

<script type="text/javascript">
"use strict";
var DATA={shinkis:[],armors:[],individuals:[]};
//データ整形ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
var conv=function(row,n){
	var armor = {};

	armor.part=n;
	armor.set=row[0];
	armor.class = row[1];
	armor.name=row[2];
	armor.rarelity=row[3];
	armor.atk=row[4];
	armor.def=row[5];
	armor.spd=row[6];
	armor.lp=row[7];
	armor.bst=row[8];
	armor.passive=row[9];
	armor.effect=row[10];
	armor.active=row[11];
	armor.active_effect=row[12];
	armor.biko=row[13];
	if(armor.biko==="-")armor.biko="";
	return armor;
}

var prepareData=function(data){
	//省略セルデータ補間
	var keys = Object.keys(data);
	for(var i=0;i < keys.length;i++){
		if(keys[i]==="lists"){ continue; }
		var list = data[keys[i]];
		for(var j=1;j<list.length;j++){
			var row = list[j];
			for(var k=0;k<row.length;k++){
				if(row[k]==="" || row[k]==="#N/A"){
					row[k]=list[j-1][k];
				}
			}
		}
		
	}
	//名称リスト
	var lists = data.lists;
	for(var i=0;i<lists[0].length;i++){
		var list=[];
		for(var j=1;j<lists.length;j++){
			if(lists[j][i] ==="")break;
			list.push(lists[j][i]);
		}
		DATA[lists[0][i]]=list;
	}

	//神姫
	for(var i=0;i<data.shinki.length;i++){
		var row = data.shinki[i];
		var shinki= {};

		shinki.cd="s"+i;
		shinki.name=row[0];
		shinki.rarelity=row[1];
		shinki.atk=row[2];
		shinki.def=row[3];
		shinki.spd=row[4];
		shinki.lp=row[5];
		shinki.bst=row[6];
		shinki.apts=row.slice(7,7+15);
		shinki.apts.unshift(0);
		shinki.rarelity=0;
		DATA.shinkis.push(shinki);
	}
	//アイコン補正
	for(var i=0;i<data.individuals.length;i++){
		var row = data.individuals[i];
		var individual= {};
		individual.name=row[0];
		individual.atk=Number(row[1]);
		individual.def=Number(row[2]);
		individual.spd=Number(row[3]);
		individual.lp=Number(row[4]);
		individual.bst=Number(row[5]);
		DATA.individuals.push(individual);
	}
	//武装
	for(var j=1;j<6;j++){
		var part=DATA.part_cd[j];
		var part_data= data[part];
		if(!part_data)continue;
		for(var i=0;i<part_data.length;i++){
			var row = part_data[i];
			var armor = conv(row,j);
			armor.cd=part.substr(0,1)+i;
			DATA.armors.push(armor);

	  		if(j===5){
	  			armor.flying=row[12];
				if(armor.flying !== 1)armor.flying=0;
			}
		}
	}

	//武器
	var part_data= data.weapon;
	for(var i=0;i<part_data.length;i++){
		var row = part_data[i];
		var armor = conv(row,6);
		armor.cd="w"+i;
		armor.category=row[14];
		armor.range=row[15];
		DATA.armors.push(armor);
	}

	DATA.armors.forEach(function(e){
		if(e.set ===""){ e.set="-"}
		if(e.set.indexOf("M")===0){
			e.set = e.set.substr(1);
			e.parent="-";
		}else{
			e.parent=e.set;
			e.set="";
		}

	});

	//パッシブ
	DATA.passives= data.passive.map(function(e){return {name:e[0],effect_type:e[1]};});


	//アクティブ
	DATA.actives = data.active.map(function(e){return {name:e[0],effect_type:e[1]};});

	//レベル増加値
	DATA.lv_bonus={};
	var sheet_data = data.lv_bonus;
	for(var i=0;i < sheet_data.length;){
		var bonuses=[];
		var part = sheet_data[i][0];
		for(var j=0;j < 4;j++){
			var bonus={};
			var row = data.lv_bonus[i];
			bonus.atk=row[3];
			bonus.def=row[4];
			bonus.spd=row[5];
			bonus.lp =row[6];
			bonus.bst=row[7];
			bonuses.push(bonus);
			i++;
		}
		DATA.lv_bonus[part] = bonuses;
	}

	DATA.shinki_rarelity_bonus=[
		{atk:0,def:0,spd:0,lp:0,bst:0}
		,{atk:5,def:5,spd:10,lp:50,bst:20}
		,{atk:10,def:10,spd:20,lp:100,bst:40}
		,{atk:15,def:15,spd:30,lp:150,bst:60}
	];

	//初期値
	DATA.default={};
	DATA.default.shinki={cd:DATA.shinkis[0].cd,rarelity:0};

	DATA.part_cd.forEach(function(e,idx){
		if(idx===0)return;
		var part_idx = idx;
		DATA.default[e]={cd:0,rarelity:0};
		if(part_idx=== 7){ part_idx=6;};
		DATA.default[e].cd=DATA.armors.find(function(e){
	  		return e.part===part_idx && e.name !=="-" && e.rarelity === 0}).cd;
	});

	DATA.date= Date.now();


    let blob = new Blob(["var DATA=",JSON.stringify(DATA),";"],{type:"text/plan"});
	var a =document.createElement('a');
	a.href=URL.createObjectURL(blob);
	a.innerText="data.js";
	a.download="data.js";
	document.body.appendChild(a);
	var span =document.querySelector('div');
	span.textContent="できた";
	document.body.appendChild(span);
}
</script>
<script type="text/javascript" src="https://script.google.com/macros/s/AKfycbx-WLdGV8_s5s3Cus5xIltvzh76ML8EnPhmP2pX0t4/dev"></script>
</html>


